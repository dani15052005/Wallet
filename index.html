<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Simulador de gastos</title>

  <link rel="stylesheet" href="styles.css"/>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4/dist/chart.umd.min.js"></script>
  <script defer src="script.js"></script>

  <!-- Manifest PWA -->
  <link rel="manifest" href="manifest.json">

  <!-- iOS: icono para “Añadir a pantalla de inicio” (180x180 en la RAÍZ) -->
  <link rel="apple-touch-icon" href="apple-touch-icon.png" sizes="180x180">
  <meta name="apple-mobile-web-app-title" content="Gastos">

  <!-- Favicon grande (Android/desktop) -->
  <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png">

  <!-- PWA en iOS standalone (opcional recomendado) -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="mobile-web-app-capable" content="yes">

  <!-- Color del navegador -->
  <meta name="theme-color" content="#4caf50">

  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('service-worker.js')
        .then(reg => console.log('Service Worker registrado', reg))
        .catch(err => console.error('Error registrando SW:', err));
    }
  </script>
</head>

<body>
  <!-- Menú hamburguesa -->
  <header>
    <h1>💸 Gastos Mensuales</h1>
    <button id="menuToggle" class="hamburger" aria-label="Abrir menú" aria-controls="menu" aria-expanded="false"></button>
  </header>

  <nav id="menu" class="menu-cerrado">
    <ul>
      <li data-section="seccionFormulario">Añadir Gasto/Beneficio</li>
      <li data-section="seccionGraficoPorcentaje">Gráfica de Gastos</li>
      <li data-section="seccionGraficoDiario">Gastos vs Beneficios (mensual)</li>
      <li data-section="seccionHistorico">Histórico de Meses</li>
    </ul>
  </nav>

  <main class="container">
    <!-- Dark Mode -->
    <button id="toggleDark"><span id="darkIcon">🌙</span></button>

    <!-- Sección formulario -->
    <section id="seccionFormulario">
      <div id="presupuesto-container">
        <label for="presupuesto">Presupuesto mensual (€):</label>
        <input type="number" id="presupuesto" placeholder="Ej. 1000">
      </div>

      <form id="formulario">
        <select id="tipo">
          <option value="gasto">Gasto</option>
          <option value="beneficio">Beneficio</option>
        </select>
        <input type="text" id="categoria" placeholder="Ej. Transporte" />
        <input type="number" id="importe" placeholder="Ej. 120" />
        <input type="date" id="fecha" />
        <button type="submit">Agregar</button>
      </form>

      <div id="filtros">
        <input type="text" id="buscarCategoria" placeholder="Filtrar por categoría">
        <input type="month" id="filtrarMes">
      </div>

      <div class="tabla-scroll">
        <table>
         <thead>
           <tr>
            <th>Tipo</th>
            <th>Categoría</th>
            <th>Importe (€)</th>
            <th>Fecha</th>
            <th>Acciones</th>
           </tr>
         </thead>
         <tbody id="tablaGastos"></tbody>
        </table>
      </div>

      <div id="total">Total: 0 €</div>
      <div id="alertaPresupuesto"></div>

      <div id="exportar-importar">
        <button id="exportCSV">Exportar CSV</button>
        <button id="exportJSON">Exportar JSON</button>
        <input type="file" id="importJSON" accept=".json">
      </div>
    </section>

    <section id="seccionGraficoPorcentaje" class="oculto">
      <h2>📊 Distribución de Gastos</h2>
      <canvas id="graficoGastos"></canvas>
    </section>

    <section id="seccionGraficoDiario" class="oculto">
      <h2 id="tituloGraficoDiario">📊 Gastos vs Beneficios</h2>
      <canvas id="graficoDiario"></canvas>
    </section>

    <section id="seccionHistorico" class="oculto">
      <h2>📅 Histórico de Meses</h2>
      <label for="selectMesHistorico">Selecciona un mes:</label>
      <select id="selectMesHistorico"></select>
      <canvas id="graficoHistorico" style="margin-top: 1rem;"></canvas>
      <div id="balanceHistorico" style="margin-top: 1rem; font-weight:bold;"></div>
    </section>
  </main>
</body>
</html>