<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Simulador de gastos</title>

  <link rel="stylesheet" href="styles.css"/>
  <!-- Chart.js local para funcionar sin conexión -->
  <script src="chart.umd.min.js"></script>
  <script defer src="script.js"></script>

  <!-- Manifest PWA -->
  <link rel="manifest" href="manifest.json">

  <!-- iOS: icono para “Añadir a pantalla de inicio” (180x180 en la RAÍZ) -->
  <link rel="apple-touch-icon" href="apple-touch-icon.png" sizes="180x180">
  <meta name="apple-mobile-web-app-title" content="Gestor Financiero">

  <!-- Favicon grande (Android/desktop) -->
  <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png">

  <!-- PWA en iOS standalone (opcional recomendado) -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="mobile-web-app-capable" content="yes">

  <!-- Color del navegador -->
  <meta name="theme-color" content="#4caf50">

  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('service-worker.js')
        .then(reg => console.log('Service Worker registrado', reg))
        .catch(err => console.error('Error registrando SW:', err));
    }
  </script>
</head>

<body>
  <!-- Menú hamburguesa -->
  <header>
    <h1>Gestor Financiero</h1>
    <button
      id="menuToggle"
      class="hamburger"
      aria-label="Abrir menú"
      aria-controls="menu"
      aria-expanded="false">
      <span class="bar"></span>
      <span class="bar"></span>
      <span class="bar"></span>
    </button>
  </header>

  <nav id="menu" class="menu-cerrado">
    <ul>
      <li data-section="seccionFormulario">Añadir Gasto/Beneficio</li>
      <li data-section="seccionGraficoPorcentaje">Gráfica de Gastos</li>
      <li data-section="seccionGraficoDiario">Gastos vs Beneficios (mensual)</li>
      <li data-section="seccionHistorico">Histórico de Meses</li>
    </ul>
  </nav>

  <main class="container">
    <!-- Dark Mode -->
    <button id="toggleDark"><span id="darkIcon">🌙</span></button>

    <!-- Onboarding: guía rápida para nuevos -->
    <div id="onboardingCard" class="onboard-card" aria-live="polite" hidden>
      <h3>Empezamos en 1 minuto</h3>
      <ul class="onboard-list">
        <li class="onboard-item" data-key="presupuesto">
          <span class="check" aria-hidden="true">○</span>
          <span>Define tu presupuesto mensual</span>
        </li>
        <li class="onboard-item" data-key="primerGasto">
          <span class="check" aria-hidden="true">○</span>
          <span>Añade tu primer gasto</span>
        </li>
        <li class="onboard-item" data-key="graficos">
          <span class="check" aria-hidden="true">○</span>
          <span>Mira tus gráficos</span>
        </li>
      </ul>
      <div class="onboard-actions">
        <button id="onboardSkip" class="btn-secondary" type="button">Saltar</button>
        <button id="onboardClose" class="btn-primary" type="button">Entendido</button>
      </div>
    </div>

    <!-- Sección formulario -->
    <section id="seccionFormulario">
      <div id="presupuesto-container">
        <label for="presupuesto">Presupuesto mensual (€):</label>
        <input type="number" id="presupuesto" placeholder="Ej. 1000">
      </div>

      <!-- Presupuestos por categoría -->
<div id="catBudgetPanel" class="catbudget-card">
  <h3>Presupuestos por categoría</h3>
  <div class="catbudget-row">
    <input type="text" id="catBudgetCategoria" placeholder="Categoría (ej. Comida)" list="categoriasSugeridas">
    <input type="number" id="catBudgetImporte" placeholder="€ mensual">
    <button id="catBudgetGuardar" type="button" class="btn-primary">Guardar</button>
  </div>
  <datalist id="categoriasSugeridas"></datalist>
  <div id="catBudgetList" class="catbudget-list"></div>
</div>

      <form id="formulario">
        <select id="tipo">
          <option value="gasto">Gasto</option>
          <option value="beneficio">Beneficio</option>
        </select>
        <input type="text" id="categoria" placeholder="Ej. Transporte" />
        <input type="number" id="importe" placeholder="Ej. 120" />
        <input type="date" id="fecha" />
        <label class="recur-inline">
        <input id="recurrente" type="checkbox">
              Recurrente
        </label>
        <select id="recurrenteFrecuencia">
        <option value="mensual" selected>Mensual</option>
        <!-- más adelante podrás añadir semanal/quincenal, etc. -->
        </select>

        <button type="submit">Agregar</button>
      </form>

      <div id="filtros">
        <input type="text" id="buscarCategoria" placeholder="Filtrar por categoría">
        <input type="month" id="filtrarMes">
      </div>

      <div class="tabla-scroll">
        <table>
         <thead>
           <tr>
            <th>Tipo</th>
            <th>Categoría</th>
            <th>Importe (€)</th>
            <th>Fecha</th>
            <th>Acciones</th>
           </tr>
         </thead>
         <tbody id="tablaGastos"></tbody>
        </table>
      </div>

      <!-- 👇 NUEVO: Estado vacío -->
      <div id="estadoVacio" class="empty-state" aria-live="polite" hidden>
        <h3>🗓️ Sin movimientos</h3>
        <p id="emptyStateMsg">Todavía no hay movimientos este mes.</p>
        <button id="addFirstBtn" class="btn-primary" type="button">Añadir el primero</button>
      </div>

      <div id="total">Total: 0 €</div>
      <div id="alertaPresupuesto"></div>

      <div id="exportar-importar">
        <button id="exportCSV">Exportar CSV</button>
        <button id="exportJSON">Exportar JSON</button>
        <input type="file" id="importJSON" accept=".json">
      </div>
    </section>

    <section id="seccionGraficoPorcentaje" class="oculto">
      <h2>📊 Distribución de Gastos</h2>
      <canvas id="graficoGastos"></canvas>
    </section>

    <section id="seccionGraficoDiario" class="oculto">
      <h2 id="tituloGraficoDiario">📊 Gastos vs Beneficios</h2>
      <canvas id="graficoDiario"></canvas>
    </section>

    <section id="seccionHistorico" class="oculto">
      <h2>📅 Histórico de Meses</h2>
      <label for="selectMesHistorico">Selecciona un mes:</label>
      <select id="selectMesHistorico"></select>
      <canvas id="graficoHistorico" style="margin-top: 1rem;"></canvas>
      <div id="balanceHistorico" style="margin-top: 1rem; font-weight:bold;"></div>
    </section>
  </main>

  <!-- Confirm de la app -->
  <div id="appConfirm" class="app-confirm" aria-hidden="true">
    <div class="app-confirm__backdrop"></div>
    <div class="app-confirm__dialog" role="dialog" aria-modal="true" aria-labelledby="appConfirmTitle" aria-describedby="appConfirmMsg">
      <h3 id="appConfirmTitle">Confirmar</h3>
      <p id="appConfirmMsg">¿Seguro?</p>
      <div class="app-confirm__actions">
        <button type="button" id="appConfirmCancel" class="btn-modal btn-secondary">Cancelar</button>
        <button type="button" id="appConfirmOk" class="btn-modal btn-primary">Aceptar</button>
      </div>
    </div>
  </div>
</body>
</html>