<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Simulador de gastos</title>
  <link rel="stylesheet" href="styles.css"/>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script defer src="script.js"></script>

  <link rel="manifest" href="manifest.json?v=5">
  <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png?v=5">
  <link rel="icon" type="image/png" sizes="192x192" href="icons/icon-192.png?v=5">
  <meta name="theme-color" content="#4caf50">

  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('service-worker.js')
        .then(reg => {
          console.log('Service Worker registrado', reg);
        })
        .catch(err => console.error('Error registrando SW:', err));

      // Escuchar mensajes del SW (para notificaciÃ³n de actualizaciÃ³n)
      navigator.serviceWorker.addEventListener('message', e => {
        if (e.data?.type === 'SW_UPDATED') {
          const refreshBanner = document.createElement('div');
            refreshBanner.className = 'banner-actualizacion';
            refreshBanner.innerHTML = 'Nueva versiÃ³n disponible. <button id="reloadApp">Recargar</button>';
            document.body.appendChild(refreshBanner);

        // Activar animaciÃ³n de deslizamiento
        setTimeout(() => refreshBanner.classList.add('show'), 50);
        document.getElementById('reloadApp').addEventListener('click', () => location.reload());
        }
      });
    }
  </script>
</head>
<body>
  <!-- MenÃº hamburguesa -->
  <header>
    <h1>ðŸ’¸ Gastos Mensuales</h1>
    <button id="menuToggle" class="hamburger">â˜°</button>
  </header>

  <nav id="menu" class="menu-cerrado">
    <ul>
      <li data-section="seccionFormulario">AÃ±adir Gasto/Beneficio</li>
      <li data-section="seccionGraficoPorcentaje">GrÃ¡fica de Gastos</li>
      <li data-section="seccionGraficoDiario">Gastos vs Beneficios (mensual)</li>
      <li data-section="seccionHistorico">HistÃ³rico de Meses</li>
    </ul>
  </nav>

  <main class="container">
    <!-- Dark Mode -->
    <button id="toggleDark"><span id="darkIcon">ðŸŒ™</span></button>

    <!-- SecciÃ³n formulario -->
    <section id="seccionFormulario">
      <div id="presupuesto-container">
        <label for="presupuesto">Presupuesto mensual (â‚¬):</label>
        <input type="number" id="presupuesto" placeholder="Ej. 1000">
      </div>

      <form id="formulario">
        <select id="tipo">
          <option value="gasto">Gasto</option>
          <option value="beneficio">Beneficio</option>
        </select>
        <input type="text" id="categoria" placeholder="Ej. Transporte" />
        <input type="number" id="importe" placeholder="Ej. 120" />
        <input type="date" id="fecha" />
        <button type="submit">Agregar</button>
      </form>

      <div id="filtros">
        <input type="text" id="buscarCategoria" placeholder="Filtrar por categorÃ­a">
        <input type="month" id="filtrarMes">
      </div>

      <table>
        <thead>
          <tr>
            <th>Tipo</th>
            <th>CategorÃ­a</th>
            <th>Importe (â‚¬)</th>
            <th>Fecha</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody id="tablaGastos"></tbody>
      </table>

      <div id="total">Total: 0 â‚¬</div>
      <div id="alertaPresupuesto"></div>

      <div id="exportar-importar">
        <button id="exportCSV">Exportar CSV</button>
        <button id="exportJSON">Exportar JSON</button>
        <input type="file" id="importJSON" accept=".json">
      </div>
    </section>

    <section id="seccionGraficoPorcentaje" class="oculto">
      <h2>ðŸ“Š DistribuciÃ³n de Gastos</h2>
      <canvas id="graficoGastos"></canvas>
    </section>

    <section id="seccionGraficoDiario" class="oculto">
      <h2>ðŸ“Š Gastos vs Beneficios del mes actual</h2>
      <canvas id="graficoDiario"></canvas>
    </section>

    <section id="seccionHistorico" class="oculto">
      <h2>ðŸ“… HistÃ³rico de Meses</h2>
      <label for="selectMesHistorico">Selecciona un mes:</label>
      <select id="selectMesHistorico"></select>
      <canvas id="graficoHistorico" style="margin-top: 1rem;"></canvas>
      <div id="balanceHistorico" style="margin-top: 1rem; font-weight:bold;"></div>
    </section>
  </main>
</body>
</html>
